<!doctype html>
<html lang="de">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="appName">KPI Projects</title>
  <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/assets/css/app.css" />
  <link rel="stylesheet" href="/assets/css/legend-network.css" />
</head>

<body>
  <!-- =========================================================================
       App Mount
       ========================================================================= -->
  <main id="app" class="container-fluid py-3">

    <!-- ======================================================================
         ROW 1: Header (full width)
         ====================================================================== -->
    <div class="row g-3">
      <header id="pageHeader" class="col-12" aria-label="Kopfbereich">
        <p id="appCaption" class="title mb-0"></p>
      </header>
    </div>

    <!-- ======================================================================
         ROW 2: Main (2 columns)
         - Left: Filters + Chart + Tooltip + Table Panel
         - Right: Tabs (Legend | Details | Quellen | Insights)
         ====================================================================== -->
    <div class="row g-3 align-items-start">

      <!-- LEFT COLUMN: Analysis / Chart -->
      <section class="col-12 col-lg-6" aria-label="Auswertung">

        <!-- Filters -->
        <section class="mb-2" aria-label="Filter">
          <div class="row g-2">

            <!-- Quelle (Multi-Select Dropdown) -->
            <div class="col-12 col-md-3">
              <label class="srOnly" for="srcBtn">Quelle</label>
              <div class="dropdown w-100">
                <button id="srcBtn" type="button"
                  class="btn btn-outline-secondary dropdown-toggle w-100 text-start"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  Quellen: alle
                </button>

                <div class="dropdown-menu p-2 w-100" aria-labelledby="srcBtn">
                  <div class="d-flex gap-2 mb-2">
                    <button id="srcAllBtn" type="button" class="btn btn-sm btn-outline-secondary">Alle</button>
                  </div>

                  <div id="srcList" class="d-grid gap-1" role="listbox" aria-label="Quellen"></div>
                </div>
              </div>
            </div>

            <!-- Typ (Multi-Select Dropdown) -->
            <div class="col-12 col-md-3">
              <label class="srOnly" for="typeBtn">Typ</label>
              <div class="dropdown w-100">
                <button id="typeBtn" type="button"
                  class="btn btn-outline-secondary dropdown-toggle w-100 text-start"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  Typen: alle
                </button>

                <div class="dropdown-menu p-2 w-100" aria-labelledby="typeBtn">
                  <div class="d-flex gap-2 mb-2">
                    <button id="typeAllBtn" type="button" class="btn btn-sm btn-outline-secondary">Alle</button>
                    <button id="typeResetBtn" type="button" class="btn btn-sm btn-outline-secondary">Reset</button>
                  </div>

                  <div id="typeList" class="d-grid gap-1" role="listbox" aria-label="Typen"></div>
                </div>
              </div>
            </div>

            <!-- Kategorie (Multi-Select Dropdown) -->
            <div class="col-12 col-md-3">
              <label class="srOnly" for="catBtn">Kategorie</label>
              <div class="dropdown w-100">
                <button id="catBtn" type="button"
                  class="btn btn-outline-secondary dropdown-toggle w-100 text-start"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  Kategorien: alle
                </button>

                <div class="dropdown-menu p-2 w-100" aria-labelledby="catBtn">
                  <div class="d-flex gap-2 mb-2">
                    <button id="catAllBtn" type="button" class="btn btn-sm btn-outline-secondary">Alle</button>
                    <button id="catResetBtn" type="button" class="btn btn-sm btn-outline-secondary">Reset</button>
                  </div>

                  <div id="catList" class="d-grid gap-1" role="listbox" aria-label="Kategorien"></div>
                </div>
              </div>
            </div>

            <!-- Modus -->
            <div class="col-12 col-md-3">
              <label class="srOnly" for="modeSelect">Modus</label>
              <select id="modeSelect" class="form-select">
                <option value="kosten">Kosten (€)</option>
                <option value="menge">Menge</option>
              </select>
            </div>

          </div>
        </section>

        <!-- Year Range (2 sliders) -->
        <section id="yearRange" class="yearRange mb-2" aria-label="Zeitraum">
          <div class="row g-2">
            <div class="col-6">
              <input id="yearFrom" class="yearRange__slider form-range" type="range" min="0" max="0" value="0" step="1" />
            </div>

            <div class="col-6">
              <input id="yearTo" class="yearRange__slider form-range" type="range" min="0" max="0" value="0" step="1" />
            </div>
          </div>
        </section>

        <!-- Chart -->
        <section id="chartWrap" class="chartWrap mb-3" aria-label="Diagramm">
          <svg id="chartSvg" role="img" aria-label="Diagramm"></svg>
        </section>

        <!-- Tooltip (als eigenes Panel, kein Accordion) -->
        <section id="tooltipPanel" class="w-100 mb-3" aria-label="Tooltip">
          <section class="card">
            <div class="card-body p-0">
              <div id="categoryInspector" class="tip tip--fixed" aria-live="polite"></div>
            </div>
          </section>
        </section>

       
      </section>

      <!-- RIGHT COLUMN: Tabs -->
      <aside class="col-12 col-lg-6" aria-label="Rechtes Panel">
        <section id="panel" class="panel">

          <!-- Range Summary (bleibt global, unabhängig vom Tab) -->
          <div id="subtitle" class="yearRange__summary mb-2" aria-live="polite"></div>

          <!-- Tabs -->
          <ul class="nav nav-tabs" id="rightTabs" role="tablist" aria-label="Rechtes Panel Tabs">

            <li class="nav-item" role="presentation">
              <button class="nav-link active"
                id="legendTab"
                data-bs-toggle="tab"
                data-bs-target="#legendPane"
                type="button"
                role="tab"
                aria-controls="legendPane"
                aria-selected="true">
                Legende
              </button>
            </li>

            <li class="nav-item" role="presentation">
              <button class="nav-link"
                id="detailsTab"
                data-bs-toggle="tab"
                data-bs-target="#detailsPane"
                type="button"
                role="tab"
                aria-controls="detailsPane"
                aria-selected="false">
                Details
              </button>
            </li>

            <li class="nav-item" role="presentation">
              <button class="nav-link"
                id="sourcesTab"
                data-bs-toggle="tab"
                data-bs-target="#sourcesPane"
                type="button"
                role="tab"
                aria-controls="sourcesPane"
                aria-selected="false">
                Quellen
              </button>
            </li>

            <li class="nav-item" role="presentation">
              <button class="nav-link"
                id="insightsTab"
                data-bs-toggle="tab"
                data-bs-target="#insightsPane"
                type="button"
                role="tab"
                aria-controls="insightsPane"
                aria-selected="false">
                Insights
              </button>
            </li>

                        <li class="nav-item" role="presentation">
              <button class="nav-link"
                id="helpTab"
                data-bs-toggle="tab"
                data-bs-target="#helpPane"
                type="button"
                role="tab"
                aria-controls="helpPane"
                aria-selected="false">
                Hilfe
              </button>
            </li>

          </ul>

          <!-- Tab Content -->
          <div class="tab-content pt-3" id="rightTabContent">

            <!-- LEGEND PANE -->
            <div class="tab-pane fade show active"
              id="legendPane"
              role="tabpanel"
              aria-labelledby="legendTab"
              tabindex="0">
              <section aria-label="Kategorien">
                <div id="legend" class="legend"></div>
              </section>
            </div>

            <!-- DETAILS PANE -->
            <div class="tab-pane fade"
              id="detailsPane"
              role="tabpanel"
              aria-labelledby="detailsTab"
              tabindex="0">

              <header id="detailsHeader" class="mb-2" aria-label="Details Kopf"></header>

              <div id="detailsEmpty" class="text-muted">
                Zeile auswählen, um Details anzuzeigen.
              </div>

              <article id="detailsMarkdown" class="markdown-body" aria-label="Markdown Details"></article>

            </div>

            <!-- SOURCES PANE -->
            <div class="tab-pane fade"
              id="sourcesPane"
              role="tabpanel"
              aria-labelledby="sourcesTab"
              tabindex="0">

              <header class="mb-2" aria-label="Quellen Kopf">
                <h2 class="h6 mb-1">Aktive Datenquellen</h2>
                <div class="text-muted small">
                  Zeigt später Details zu den aktuell aktiven Quellen (Filterzustand).
                </div>
              </header>

              <div id="sourcesEmpty" class="text-muted">
                Noch keine Quelldetails vorhanden.
              </div>

              <section id="sourcesDetails" aria-label="Quellen Details"></section>

            </div>

            <!-- INSIGHTS PANE (rechts) -->
            <div class="tab-pane fade"
              id="insightsPane"
              role="tabpanel"
              aria-labelledby="insightsTab"
              tabindex="0">

              <section aria-label="Insights Inhalte">
                <div class="row g-3">

                  <div class="col-12 col-xl-6">
                    <section id="insights-summary" class="card h-100">
                      <div class="card-body">
                        <h2 class="h6 card-title mb-2">Summary</h2>
                        <div class="insights__body">Platzhalter…</div>
                      </div>
                    </section>
                  </div>

                  <div class="col-12 col-xl-6">
                    <section id="insights-anomalies" class="card h-100">
                      <div class="card-body">
                        <h2 class="h6 card-title mb-2">Anomalien</h2>
                        <div class="insights__body">Platzhalter…</div>
                      </div>
                    </section>
                  </div>

                  <div class="col-12 col-xl-6">
                    <section id="insights-trends" class="card h-100">
                      <div class="card-body">
                        <h2 class="h6 card-title mb-2">Trends</h2>
                        <div class="insights__body">Platzhalter…</div>
                      </div>
                    </section>
                  </div>

                  <div class="col-12 col-xl-6">
                    <section id="insights-notes" class="card h-100">
                      <div class="card-body">
                        <h2 class="h6 card-title mb-2">Notizen</h2>
                        <div class="insights__body">Platzhalter…</div>
                      </div>
                    </section>
                  </div>

                </div>
              </section>

            </div>

          </div>

        </section>
      </aside>

    </div>

    <!-- ======================================================================
         ROW 3: Footer (full width)
         ====================================================================== -->
    <div class="row g-3">
      <footer id="pageFooter" class="col-12" aria-label="Fußbereich"></footer>
    </div>

  </main>

  <!-- =========================================================================
       Scripts (Vendor → libs → app entry)
       ========================================================================= -->
  <script src="/assets/js/bootstrap.bundle.min.js"></script>
  <script src="/assets/js/d3.v7.min.js"></script>
  <script type="module" src="/main.js"></script>
</body>

</html>